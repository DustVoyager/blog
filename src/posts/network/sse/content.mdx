---
title: "Server-Sent Events(SSE) ì™„ë²½ ê°€ì´ë“œ"
desc: SSEì˜ ë™ì‘ ì›ë¦¬ë¶€í„° ì‹¤ì „ êµ¬í˜„ê¹Œì§€, ë‹¨ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹ ì˜ ê°„ê²°í•œ í•´ê²°ì±…
date: 2026-02-06
thumbnail: /posts/devops.png
---

![](/posts/sse.png)

# Server-Sent Events(SSE) ì™„ë²½ ê°€ì´ë“œ

Server-Sent Events(SSE)ëŠ” ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë‹¨ë°©í–¥ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ” HTML5 í‘œì¤€ ê¸°ìˆ ì…ë‹ˆë‹¤. WebSocketë³´ë‹¤ ê°„ë‹¨í•˜ë©´ì„œë„ ì‹¤ì‹œê°„ ì•Œë¦¼, ë¼ì´ë¸Œ í”¼ë“œ, ì£¼ì‹ ì‹œì„¸ ë“± ì„œë²„ í‘¸ì‹œê°€ í•„ìš”í•œ ë‹¤ì–‘í•œ ìƒí™©ì—ì„œ íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 1. SSEë€?

SSEëŠ” HTTP í”„ë¡œí† ì½œ ìœ„ì—ì„œ ë™ì‘í•˜ëŠ” **ì„œë²„ í‘¸ì‹œ ê¸°ìˆ **ì…ë‹ˆë‹¤. í•œ ë²ˆ ì—°ê²°ì„ ë§ºìœ¼ë©´ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì§€ì†ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1.1 ì£¼ìš” íŠ¹ì§•

âœ… **ë‹¨ë°©í–¥ í†µì‹ **: ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸ë§Œ ê°€ëŠ¥
âœ… **ìë™ ì¬ì—°ê²°**: ì—°ê²°ì´ ëŠê¸°ë©´ ìë™ìœ¼ë¡œ ì¬ì‹œë„
âœ… **ì´ë²¤íŠ¸ ID ì§€ì›**: ì¬ì—°ê²° ì‹œ ë§ˆì§€ë§‰ ì´ë²¤íŠ¸ë¶€í„° ì´ì–´ë°›ê¸° ê°€ëŠ¥
âœ… **í…ìŠ¤íŠ¸ ê¸°ë°˜**: UTF-8 í…ìŠ¤íŠ¸ ë°ì´í„° ì „ì†¡
âœ… **HTTP ê¸°ë°˜**: ê¸°ì¡´ ì¸í”„ë¼ í™œìš© ê°€ëŠ¥
âœ… **ê°„ë‹¨í•œ êµ¬í˜„**: WebSocketë³´ë‹¤ í›¨ì”¬ ë‹¨ìˆœ

### 1.2 SSE vs WebSocket

| íŠ¹ì§• | SSE | WebSocket |
|------|-----|-----------|
| **ë°©í–¥ì„±** | ë‹¨ë°©í–¥ (ì„œë²„â†’í´ë¼ì´ì–¸íŠ¸) | ì–‘ë°©í–¥ |
| **í”„ë¡œí† ì½œ** | HTTP | ë…ë¦½ í”„ë¡œí† ì½œ |
| **ì¬ì—°ê²°** | ìë™ | ìˆ˜ë™ êµ¬í˜„ í•„ìš” |
| **ë°ì´í„° í˜•ì‹** | í…ìŠ¤íŠ¸ë§Œ | í…ìŠ¤íŠ¸/ë°”ì´ë„ˆë¦¬ |
| **ë¸Œë¼ìš°ì € ì§€ì›** | ëŒ€ë¶€ë¶„ (IE ì œì™¸) | ëª¨ë“  ëª¨ë˜ ë¸Œë¼ìš°ì € |
| **êµ¬í˜„ ë³µì¡ë„** | ë‚®ìŒ | ë†’ìŒ |
| **ì í•©í•œ ê²½ìš°** | ì•Œë¦¼, í”¼ë“œ, ëª¨ë‹ˆí„°ë§ | ì±„íŒ…, ê²Œì„, í˜‘ì—… íˆ´ |

![](/posts/sse-vs-websocket.png)

---

## 2. SSE ë™ì‘ ì›ë¦¬

### 2.1 ì—°ê²° ìˆ˜ë¦½

í´ë¼ì´ì–¸íŠ¸ê°€ SSE ì—”ë“œí¬ì¸íŠ¸ì— HTTP GET ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.

**í´ë¼ì´ì–¸íŠ¸ ìš”ì²­:**
```http
GET /events HTTP/1.1
Host: example.com
Accept: text/event-stream
Cache-Control: no-cache
```

**ì„œë²„ ì‘ë‹µ:**
```http
HTTP/1.1 200 OK
Content-Type: text/event-stream
Cache-Control: no-cache
Connection: keep-alive

data: Hello World

```

### 2.2 ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ í˜•ì‹

SSEëŠ” íŠ¹ì • í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.

```
data: ì²« ë²ˆì§¸ ë©”ì‹œì§€

data: ë‘ ë²ˆì§¸ ë©”ì‹œì§€
id: 2

event: userJoined
data: {"username": "Alice"}
id: 3

data: ì—¬ëŸ¬ ì¤„ì— ê±¸ì¹œ
data: ë©”ì‹œì§€ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤
id: 4

: ì´ê²ƒì€ ì£¼ì„ì…ë‹ˆë‹¤

```

**í•„ë“œ ì„¤ëª…:**
- `data:` ì‹¤ì œ ë°ì´í„° (í•„ìˆ˜, ì—¬ëŸ¬ ì¤„ ê°€ëŠ¥)
- `event:` ì´ë²¤íŠ¸ íƒ€ì… (ì„ íƒ, ê¸°ë³¸ê°’ "message")
- `id:` ì´ë²¤íŠ¸ ID (ì„ íƒ, ì¬ì—°ê²° ì‹œ ì‚¬ìš©)
- `retry:` ì¬ì—°ê²° ëŒ€ê¸° ì‹œê°„(ms) (ì„ íƒ)
- `:` ì£¼ì„ (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¬´ì‹œ)

**ì¤‘ìš”:** ê° ì´ë²¤íŠ¸ëŠ” ë¹ˆ ì¤„(`\n\n`)ë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤.

![](/posts/sse-protocol.png)

---

## 3. í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„

### 3.1 ê¸°ë³¸ ì‚¬ìš©ë²•

```javascript
// EventSource ê°ì²´ ìƒì„±
const eventSource = new EventSource('/api/events');

// ê¸°ë³¸ ë©”ì‹œì§€ ìˆ˜ì‹  (event íƒ€ì… ì—†ëŠ” ê²½ìš°)
eventSource.addEventListener('message', (event) => {
  console.log('ìƒˆ ë©”ì‹œì§€:', event.data);
});

// íŠ¹ì • ì´ë²¤íŠ¸ íƒ€ì… ìˆ˜ì‹ 
eventSource.addEventListener('userJoined', (event) => {
  const data = JSON.parse(event.data);
  console.log(`${data.username}ë‹˜ì´ ì…ì¥í–ˆìŠµë‹ˆë‹¤`);
});

// ì—°ê²° ì„±ê³µ
eventSource.addEventListener('open', () => {
  console.log('SSE ì—°ê²° ì„±ê³µ');
});

// ì—ëŸ¬ ì²˜ë¦¬
eventSource.addEventListener('error', (error) => {
  console.error('SSE ì—ëŸ¬:', error);

  if (eventSource.readyState === EventSource.CLOSED) {
    console.log('ì—°ê²°ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤');
  }
});

// ì—°ê²° ì¢…ë£Œ
// eventSource.close();
```

### 3.2 ì‹¤ì „ ì˜ˆì œ: ì‹¤ì‹œê°„ ì•Œë¦¼

```javascript
class NotificationService {
  constructor(url) {
    this.url = url;
    this.eventSource = null;
    this.reconnectAttempts = 0;
    this.maxReconnectAttempts = 5;
  }

  connect() {
    // ê¸°ì¡´ ì—°ê²°ì´ ìˆìœ¼ë©´ ì¢…ë£Œ
    if (this.eventSource) {
      this.eventSource.close();
    }

    this.eventSource = new EventSource(this.url);

    this.eventSource.onopen = () => {
      console.log('ì•Œë¦¼ ì„œë¹„ìŠ¤ ì—°ê²°ë¨');
      this.reconnectAttempts = 0;
      this.onConnected?.();
    };

    // ì¼ë°˜ ì•Œë¦¼
    this.eventSource.addEventListener('notification', (event) => {
      const notification = JSON.parse(event.data);
      this.showNotification(notification);
    });

    // ê¸´ê¸‰ ì•Œë¦¼
    this.eventSource.addEventListener('urgent', (event) => {
      const notification = JSON.parse(event.data);
      this.showUrgentNotification(notification);
    });

    // ì‹œìŠ¤í…œ ë©”ì‹œì§€
    this.eventSource.addEventListener('system', (event) => {
      const message = JSON.parse(event.data);
      this.handleSystemMessage(message);
    });

    this.eventSource.onerror = (error) => {
      console.error('SSE ì—ëŸ¬:', error);

      if (this.eventSource.readyState === EventSource.CLOSED) {
        this.handleReconnect();
      }
    };
  }

  handleReconnect() {
    if (this.reconnectAttempts < this.maxReconnectAttempts) {
      this.reconnectAttempts++;
      const delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 30000);

      console.log(`${delay}ms í›„ ì¬ì—°ê²° ì‹œë„...`);
      setTimeout(() => this.connect(), delay);
    } else {
      console.error('ìµœëŒ€ ì¬ì—°ê²° ì‹œë„ íšŸìˆ˜ ì´ˆê³¼');
      this.onMaxReconnectReached?.();
    }
  }

  showNotification(notification) {
    // ë¸Œë¼ìš°ì € ì•Œë¦¼ í‘œì‹œ
    if (Notification.permission === 'granted') {
      new Notification(notification.title, {
        body: notification.message,
        icon: notification.icon,
        tag: notification.id
      });
    }

    // UI ì—…ë°ì´íŠ¸
    this.onNotification?.(notification);
  }

  showUrgentNotification(notification) {
    // ê¸´ê¸‰ ì•Œë¦¼ì€ ì†Œë¦¬ì™€ í•¨ê»˜
    const audio = new Audio('/notification-urgent.mp3');
    audio.play();

    this.showNotification({
      ...notification,
      urgent: true
    });
  }

  handleSystemMessage(message) {
    switch (message.type) {
      case 'maintenance':
        this.onMaintenance?.(message);
        break;
      case 'update':
        this.onUpdate?.(message);
        break;
      default:
        console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€:', message);
    }
  }

  disconnect() {
    if (this.eventSource) {
      this.eventSource.close();
      this.eventSource = null;
    }
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
const notifications = new NotificationService('/api/notifications');

notifications.onConnected = () => {
  console.log('ì•Œë¦¼ì„ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤');
};

notifications.onNotification = (notification) => {
  addNotificationToUI(notification);
};

notifications.onMaintenance = (message) => {
  showMaintenanceBanner(message);
};

notifications.connect();
```

### 3.3 React Hook ì˜ˆì œ

```javascript
import { useEffect, useState, useRef } from 'react';

function useSSE(url, options = {}) {
  const [data, setData] = useState(null);
  const [isConnected, setIsConnected] = useState(false);
  const [error, setError] = useState(null);
  const eventSourceRef = useRef(null);

  useEffect(() => {
    const eventSource = new EventSource(url);
    eventSourceRef.current = eventSource;

    eventSource.onopen = () => {
      setIsConnected(true);
      setError(null);
    };

    eventSource.onmessage = (event) => {
      try {
        const parsedData = JSON.parse(event.data);
        setData(parsedData);
        options.onMessage?.(parsedData);
      } catch (err) {
        setData(event.data);
        options.onMessage?.(event.data);
      }
    };

    eventSource.onerror = (err) => {
      setIsConnected(false);
      setError(err);
      options.onError?.(err);
    };

    // í´ë¦°ì—…
    return () => {
      eventSource.close();
    };
  }, [url]);

  return { data, isConnected, error };
}

// ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©
function LiveFeed() {
  const { data, isConnected } = useSSE('/api/feed');

  return (
    <div>
      <div className="status">
        {isConnected ? 'ğŸŸ¢ ì‹¤ì‹œê°„' : 'ğŸ”´ ì—°ê²° ëŠê¹€'}
      </div>
      {data && (
        <div className="feed-item">
          <h3>{data.title}</h3>
          <p>{data.content}</p>
          <small>{new Date(data.timestamp).toLocaleString()}</small>
        </div>
      )}
    </div>
  );
}

// ì—¬ëŸ¬ ì´ë²¤íŠ¸ íƒ€ì… ì²˜ë¦¬
function useSSEMultiEvent(url, eventHandlers) {
  const [isConnected, setIsConnected] = useState(false);
  const eventSourceRef = useRef(null);

  useEffect(() => {
    const eventSource = new EventSource(url);
    eventSourceRef.current = eventSource;

    eventSource.onopen = () => setIsConnected(true);
    eventSource.onerror = () => setIsConnected(false);

    // ê° ì´ë²¤íŠ¸ íƒ€ì…ì— ëŒ€í•œ í•¸ë“¤ëŸ¬ ë“±ë¡
    Object.entries(eventHandlers).forEach(([eventType, handler]) => {
      eventSource.addEventListener(eventType, (event) => {
        handler(JSON.parse(event.data));
      });
    });

    return () => eventSource.close();
  }, [url]);

  return { isConnected };
}

// ì‚¬ìš© ì˜ˆì‹œ
function Dashboard() {
  const { isConnected } = useSSEMultiEvent('/api/events', {
    stockPrice: (data) => updateStockPrice(data),
    news: (data) => addNewsItem(data),
    alert: (data) => showAlert(data)
  });

  return <div>ì—°ê²°: {isConnected ? 'âœ“' : 'âœ—'}</div>;
}
```

![](/posts/sse-client-flow.png)

---

## 4. ì„œë²„ êµ¬í˜„

### 4.1 Node.js (Express)

```javascript
const express = require('express');
const app = express();

// SSE ì—”ë“œí¬ì¸íŠ¸
app.get('/api/events', (req, res) => {
  // SSE í—¤ë” ì„¤ì •
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');

  // CORS ì„¤ì • (í•„ìš”í•œ ê²½ìš°)
  res.setHeader('Access-Control-Allow-Origin', '*');

  // ì´ˆê¸° ì—°ê²° í™•ì¸ ë©”ì‹œì§€
  res.write('data: Connected\n\n');

  // ì£¼ê¸°ì ìœ¼ë¡œ ë°ì´í„° ì „ì†¡
  const intervalId = setInterval(() => {
    const data = {
      timestamp: Date.now(),
      message: 'Hello from server'
    };

    res.write(`data: ${JSON.stringify(data)}\n\n`);
  }, 1000);

  // í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì¢…ë£Œ ì‹œ ì •ë¦¬
  req.on('close', () => {
    clearInterval(intervalId);
    console.log('í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì¢…ë£Œ');
  });
});

app.listen(3000, () => {
  console.log('Server running on http://localhost:3000');
});
```

### 4.2 ì‹¤ì „ ì˜ˆì œ: ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ

```javascript
const express = require('express');
const app = express();

// ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ ê´€ë¦¬
class SSEManager {
  constructor() {
    this.clients = new Map(); // userId -> response object
  }

  addClient(userId, res) {
    this.clients.set(userId, res);
    console.log(`í´ë¼ì´ì–¸íŠ¸ ì¶”ê°€: ${userId}, ì´ ${this.clients.size}ëª…`);

    // ì—°ê²° í™•ì¸ ë©”ì‹œì§€
    this.sendToClient(userId, {
      type: 'connected',
      message: 'ì•Œë¦¼ ì„œë¹„ìŠ¤ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤'
    });
  }

  removeClient(userId) {
    this.clients.delete(userId);
    console.log(`í´ë¼ì´ì–¸íŠ¸ ì œê±°: ${userId}, ì´ ${this.clients.size}ëª…`);
  }

  sendToClient(userId, data, eventType = 'message', id = null) {
    const client = this.clients.get(userId);
    if (!client) return;

    try {
      if (eventType !== 'message') {
        client.write(`event: ${eventType}\n`);
      }
      if (id) {
        client.write(`id: ${id}\n`);
      }
      client.write(`data: ${JSON.stringify(data)}\n\n`);
    } catch (error) {
      console.error(`ì „ì†¡ ì‹¤íŒ¨: ${userId}`, error);
      this.removeClient(userId);
    }
  }

  broadcast(data, eventType = 'message') {
    this.clients.forEach((client, userId) => {
      this.sendToClient(userId, data, eventType);
    });
  }

  sendToMultiple(userIds, data, eventType = 'message') {
    userIds.forEach(userId => {
      this.sendToClient(userId, data, eventType);
    });
  }
}

const sseManager = new SSEManager();

// ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ (ì‹¤ì œë¡œëŠ” JWT ë“± ì‚¬ìš©)
const authenticate = (req, res, next) => {
  const userId = req.query.userId;
  if (!userId) {
    return res.status(401).send('Unauthorized');
  }
  req.userId = userId;
  next();
};

// SSE ì—”ë“œí¬ì¸íŠ¸
app.get('/api/notifications', authenticate, (req, res) => {
  // SSE ì„¤ì •
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');
  res.setHeader('X-Accel-Buffering', 'no'); // Nginx ë²„í¼ë§ ë¹„í™œì„±í™”

  const userId = req.userId;

  // í´ë¼ì´ì–¸íŠ¸ ì¶”ê°€
  sseManager.addClient(userId, res);

  // Keep-alive (30ì´ˆë§ˆë‹¤ ì£¼ì„ ì „ì†¡)
  const keepAliveId = setInterval(() => {
    res.write(': keep-alive\n\n');
  }, 30000);

  // ì—°ê²° ì¢…ë£Œ ì²˜ë¦¬
  req.on('close', () => {
    clearInterval(keepAliveId);
    sseManager.removeClient(userId);
  });
});

// ì•Œë¦¼ ì „ì†¡ API (ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ í˜¸ì¶œ)
app.post('/api/send-notification', express.json(), (req, res) => {
  const { userId, notification } = req.body;

  sseManager.sendToClient(userId, notification, 'notification');

  res.json({ success: true });
});

// ë¸Œë¡œë“œìºìŠ¤íŠ¸ API
app.post('/api/broadcast', express.json(), (req, res) => {
  const { message } = req.body;

  sseManager.broadcast(message, 'system');

  res.json({
    success: true,
    recipients: sseManager.clients.size
  });
});

// ìƒíƒœ í™•ì¸
app.get('/api/status', (req, res) => {
  res.json({
    connections: sseManager.clients.size,
    clients: Array.from(sseManager.clients.keys())
  });
});

app.listen(3000);
```

### 4.3 ì¬ì—°ê²° ë° ì´ë²¤íŠ¸ ID ì²˜ë¦¬

```javascript
// ì´ë²¤íŠ¸ ì €ì¥ì†Œ (ì‹¤ì œë¡œëŠ” Redis ë“± ì‚¬ìš©)
const eventStore = new Map();
let eventId = 0;

app.get('/api/events', (req, res) => {
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');

  // Last-Event-ID í—¤ë”ë¡œ ì¬ì—°ê²° ê°ì§€
  const lastEventId = req.headers['last-event-id'];

  if (lastEventId) {
    // ë§ˆì§€ë§‰ ì´ë²¤íŠ¸ ì´í›„ì˜ ëª¨ë“  ì´ë²¤íŠ¸ ì „ì†¡
    const missedEvents = Array.from(eventStore.entries())
      .filter(([id]) => id > parseInt(lastEventId))
      .sort(([a], [b]) => a - b);

    missedEvents.forEach(([id, data]) => {
      res.write(`id: ${id}\n`);
      res.write(`data: ${JSON.stringify(data)}\n\n`);
    });
  }

  // ìƒˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
  const listener = (data) => {
    const currentEventId = ++eventId;

    // ì´ë²¤íŠ¸ ì €ì¥ (ìµœê·¼ 100ê°œë§Œ ìœ ì§€)
    eventStore.set(currentEventId, data);
    if (eventStore.size > 100) {
      const oldestId = Math.min(...eventStore.keys());
      eventStore.delete(oldestId);
    }

    // í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡
    res.write(`id: ${currentEventId}\n`);
    res.write(`data: ${JSON.stringify(data)}\n\n`);
  };

  eventEmitter.on('newEvent', listener);

  req.on('close', () => {
    eventEmitter.off('newEvent', listener);
  });
});

// ì¬ì—°ê²° ì‹œê°„ ì„¤ì •
app.get('/api/events', (req, res) => {
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');

  // ì¬ì—°ê²° ëŒ€ê¸° ì‹œê°„ ì„¤ì • (5ì´ˆ)
  res.write('retry: 5000\n\n');

  // ... ë‚˜ë¨¸ì§€ ì½”ë“œ
});
```

![](/posts/sse-server-flow.png)

---

## 5. ê³ ê¸‰ ê¸°ëŠ¥

### 5.1 ì´ë²¤íŠ¸ íƒ€ì…ë³„ ì²˜ë¦¬

```javascript
// ì„œë²„: ì—¬ëŸ¬ íƒ€ì…ì˜ ì´ë²¤íŠ¸ ì „ì†¡
app.get('/api/feed', (req, res) => {
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');

  // ì£¼ì‹ ê°€ê²©
  setInterval(() => {
    res.write('event: stockPrice\n');
    res.write(`data: ${JSON.stringify({ symbol: 'AAPL', price: 150.25 })}\n\n`);
  }, 1000);

  // ë‰´ìŠ¤
  setInterval(() => {
    res.write('event: news\n');
    res.write(`data: ${JSON.stringify({ title: 'Breaking News', url: '/news/123' })}\n\n`);
  }, 5000);

  // ì•Œë¦¼
  setInterval(() => {
    res.write('event: alert\n');
    res.write(`data: ${JSON.stringify({ message: 'System update' })}\n\n`);
  }, 10000);
});

// í´ë¼ì´ì–¸íŠ¸: ì´ë²¤íŠ¸ íƒ€ì…ë³„ ì²˜ë¦¬
const eventSource = new EventSource('/api/feed');

eventSource.addEventListener('stockPrice', (event) => {
  const data = JSON.parse(event.data);
  updateStockPrice(data.symbol, data.price);
});

eventSource.addEventListener('news', (event) => {
  const data = JSON.parse(event.data);
  addNewsItem(data.title, data.url);
});

eventSource.addEventListener('alert', (event) => {
  const data = JSON.parse(event.data);
  showAlert(data.message);
});
```

### 5.2 ì••ì¶•

```javascript
const compression = require('compression');

app.use(compression({
  filter: (req, res) => {
    if (req.headers['accept'] === 'text/event-stream') {
      return false; // SSEëŠ” ì••ì¶•í•˜ì§€ ì•ŠìŒ
    }
    return compression.filter(req, res);
  }
}));
```

### 5.3 í”„ë¡ì‹œ ê³ ë ¤ì‚¬í•­

```javascript
// Nginx ì„¤ì •
location /api/events {
    proxy_pass http://backend;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_buffering off;
    proxy_cache off;
    proxy_read_timeout 24h;
}

// Express: X-Accel-Buffering í—¤ë”
res.setHeader('X-Accel-Buffering', 'no');
```

---

## 6. í”„ë¡œë•ì…˜ ê³ ë ¤ì‚¬í•­

### 6.1 ìŠ¤ì¼€ì¼ë§

```javascript
// Redis Pub/Subë¡œ ì—¬ëŸ¬ ì„œë²„ ê°„ ì´ë²¤íŠ¸ ê³µìœ 
const Redis = require('ioredis');
const pub = new Redis();
const sub = new Redis();

// êµ¬ë…
sub.subscribe('notifications');
sub.on('message', (channel, message) => {
  const data = JSON.parse(message);
  sseManager.sendToClient(data.userId, data.notification);
});

// ë°œí–‰ (ë‹¤ë¥¸ ì„œë²„ì—ì„œ)
pub.publish('notifications', JSON.stringify({
  userId: '123',
  notification: { message: 'Hello' }
}));
```

### 6.2 ì—°ê²° ìˆ˜ ëª¨ë‹ˆí„°ë§

```javascript
// ë©”íŠ¸ë¦­ ìˆ˜ì§‘
const metrics = {
  activeConnections: 0,
  totalConnections: 0,
  messagesSent: 0
};

app.get('/metrics', (req, res) => {
  res.json({
    ...metrics,
    activeConnections: sseManager.clients.size
  });
});
```

### 6.3 ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬

```javascript
// í´ë¼ì´ì–¸íŠ¸: ì—ëŸ¬ ì¬ì‹œë„ ë¡œì§
class RobustSSE {
  constructor(url, maxRetries = 5) {
    this.url = url;
    this.maxRetries = maxRetries;
    this.retryCount = 0;
    this.connect();
  }

  connect() {
    this.eventSource = new EventSource(this.url);

    this.eventSource.onopen = () => {
      this.retryCount = 0;
      console.log('ì—°ê²° ì„±ê³µ');
    };

    this.eventSource.onerror = (error) => {
      console.error('SSE ì—ëŸ¬:', error);

      if (this.eventSource.readyState === EventSource.CLOSED) {
        this.reconnect();
      }
    };
  }

  reconnect() {
    if (this.retryCount < this.maxRetries) {
      this.retryCount++;
      const delay = Math.min(1000 * Math.pow(2, this.retryCount), 30000);

      console.log(`${delay}ms í›„ ì¬ì—°ê²°... (${this.retryCount}/${this.maxRetries})`);

      setTimeout(() => {
        this.eventSource.close();
        this.connect();
      }, delay);
    } else {
      console.error('ìµœëŒ€ ì¬ì—°ê²° ì‹œë„ íšŸìˆ˜ ì´ˆê³¼');
    }
  }

  close() {
    this.eventSource.close();
  }
}
```

---

## 7. ì‹¤ì „ ì‚¬ìš© ì‚¬ë¡€

### 7.1 ì‹¤ì‹œê°„ ì£¼ì‹ ì‹œì„¸

```javascript
// ì„œë²„
app.get('/api/stock/:symbol', (req, res) => {
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');

  const symbol = req.params.symbol;

  const interval = setInterval(() => {
    const price = getStockPrice(symbol); // ì‹¤ì œ API í˜¸ì¶œ

    res.write(`event: price\n`);
    res.write(`data: ${JSON.stringify({
      symbol,
      price,
      change: calculateChange(price),
      timestamp: Date.now()
    })}\n\n`);
  }, 1000);

  req.on('close', () => clearInterval(interval));
});

// í´ë¼ì´ì–¸íŠ¸
const stockFeed = new EventSource('/api/stock/AAPL');
stockFeed.addEventListener('price', (event) => {
  const data = JSON.parse(event.data);
  updateStockWidget(data);
});
```

### 7.2 ë¹Œë“œ/ë°°í¬ ì§„í–‰ ìƒí™©

```javascript
// ì„œë²„
app.get('/api/build/:id/events', (req, res) => {
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');

  const buildId = req.params.id;

  // ë¹Œë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
  buildEmitter.on(buildId, (event) => {
    res.write(`event: ${event.type}\n`);
    res.write(`data: ${JSON.stringify(event.data)}\n\n`);

    if (event.type === 'completed' || event.type === 'failed') {
      // ë¹Œë“œ ì™„ë£Œ ì‹œ ì—°ê²° ì¢…ë£Œ
      res.end();
    }
  });

  req.on('close', () => {
    buildEmitter.off(buildId);
  });
});

// í´ë¼ì´ì–¸íŠ¸
const buildStream = new EventSource(`/api/build/${buildId}/events`);

buildStream.addEventListener('started', (e) => {
  console.log('ë¹Œë“œ ì‹œì‘');
});

buildStream.addEventListener('progress', (e) => {
  const data = JSON.parse(e.data);
  updateProgressBar(data.percentage);
});

buildStream.addEventListener('log', (e) => {
  const data = JSON.parse(e.data);
  appendLog(data.message);
});

buildStream.addEventListener('completed', (e) => {
  console.log('ë¹Œë“œ ì™„ë£Œ');
  buildStream.close();
});
```

### 7.3 AI ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ (ChatGPT ìŠ¤íƒ€ì¼)

```javascript
// ì„œë²„
app.get('/api/chat/stream', async (req, res) => {
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');

  const prompt = req.query.prompt;

  try {
    // OpenAI ìŠ¤íŠ¸ë¦¬ë° (ì˜ˆì‹œ)
    const stream = await openai.chat.completions.create({
      model: 'gpt-4',
      messages: [{ role: 'user', content: prompt }],
      stream: true
    });

    for await (const chunk of stream) {
      const content = chunk.choices[0]?.delta?.content || '';

      if (content) {
        res.write(`data: ${JSON.stringify({ content })}\n\n`);
      }
    }

    res.write('data: [DONE]\n\n');
    res.end();
  } catch (error) {
    res.write(`event: error\n`);
    res.write(`data: ${JSON.stringify({ error: error.message })}\n\n`);
    res.end();
  }
});

// í´ë¼ì´ì–¸íŠ¸
function streamChat(prompt) {
  const eventSource = new EventSource(`/api/chat/stream?prompt=${encodeURIComponent(prompt)}`);
  let fullResponse = '';

  eventSource.addEventListener('message', (event) => {
    if (event.data === '[DONE]') {
      eventSource.close();
      onComplete(fullResponse);
      return;
    }

    const { content } = JSON.parse(event.data);
    fullResponse += content;
    onChunk(content);
  });

  eventSource.addEventListener('error', (event) => {
    const { error } = JSON.parse(event.data);
    onError(error);
    eventSource.close();
  });
}
```

![](/posts/sse-use-cases.png)

---

## 8. ë§ˆë¬´ë¦¬

SSEëŠ” ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œì˜ ë‹¨ë°©í–¥ í†µì‹ ì´ í•„ìš”í•œ ê²½ìš° WebSocketë³´ë‹¤ ê°„ë‹¨í•˜ê³  íš¨ìœ¨ì ì¸ ì„ íƒì…ë‹ˆë‹¤. HTTP ê¸°ë°˜ì´ë¯€ë¡œ ê¸°ì¡´ ì¸í”„ë¼ë¥¼ ê·¸ëŒ€ë¡œ í™œìš©í•  ìˆ˜ ìˆìœ¼ë©°, ìë™ ì¬ì—°ê²° ê¸°ëŠ¥ìœ¼ë¡œ ì•ˆì •ì„±ë„ ë›°ì–´ë‚©ë‹ˆë‹¤.

**SSEë¥¼ ì„ íƒí•´ì•¼ í•˜ëŠ” ê²½ìš°:**
- ì‹¤ì‹œê°„ ì•Œë¦¼, í”¼ë“œ, ëª¨ë‹ˆí„°ë§
- ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œë§Œ ë°ì´í„° ì „ì†¡
- ê°„ë‹¨í•œ êµ¬í˜„ì´ í•„ìš”í•œ ê²½ìš°
- HTTP ì¸í”„ë¼ë¥¼ í™œìš©í•˜ê³  ì‹¶ì€ ê²½ìš°

**WebSocketì„ ì„ íƒí•´ì•¼ í•˜ëŠ” ê²½ìš°:**
- ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹  í•„ìš”
- ë°”ì´ë„ˆë¦¬ ë°ì´í„° ì „ì†¡
- ë§¤ìš° ë‚®ì€ ì§€ì—°ì‹œê°„ ìš”êµ¬
- í´ë¼ì´ì–¸íŠ¸ì—ì„œë„ ë¹ˆë²ˆí•œ ë°ì´í„° ì „ì†¡

## Reference

- [MDN EventSource API](https://developer.mozilla.org/en-US/docs/Web/API/EventSource)
- [HTML Standard - Server-Sent Events](https://html.spec.whatwg.org/multipage/server-sent-events.html)
- [SSE vs WebSocket](https://ably.com/topic/server-sent-events-vs-websockets)
- [Express SSE Implementation](https://masteringjs.io/tutorials/express/server-sent-events)
